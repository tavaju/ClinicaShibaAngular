<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>Dashboard de Clínica Shiba</h1>
    <div class="last-update">
      <span>Última actualización: {{ loading ? 'Cargando...' : error ? 'Error al cargar' : (currentDate | date: 'dd/MM/yyyy HH:mm') }}</span>
      <button (click)="loadDashboardData()" class="btn btn-sm btn-refresh">
        <i class="fa fa-refresh"></i> Actualizar
      </button>
    </div>
  </div>

  <!-- Spinner de carga -->
  <div *ngIf="loading" class="loading-spinner">
    <div class="spinner"></div>
    <p>Cargando datos del dashboard...</p>
  </div>

  <!-- Mensaje de error -->
  <div *ngIf="error && !loading" class="error-message">
    <i class="fa fa-exclamation-triangle"></i>
    <p>Ha ocurrido un error al cargar los datos. Por favor, intenta nuevamente.</p>
    <button (click)="loadDashboardData()" class="btn btn-primary">Reintentar</button>
  </div>

  <!-- Contenido del dashboard -->
  <div *ngIf="!loading && !error && dashboardData" class="dashboard-content">
    <!-- Tarjetas de métricas -->
    <div class="metrics-row">
      <div class="metric-card">
        <div class="metric-icon">
          <i class="fa fa-medkit"></i>
        </div>
        <div class="metric-info">
          <h3>Tratamientos (último mes)</h3>
          <div class="metric-value">{{ dashboardData.totalTratamientosUltimoMes }}</div>
        </div>
      </div>
      
      <div class="metric-card">
        <div class="metric-icon">
          <i class="fa fa-paw"></i>
        </div>
        <div class="metric-info">
          <h3>Mascotas Activas</h3>
          <div class="metric-value">{{ dashboardData.mascotasActivas }}</div>
          <div class="metric-subvalue">de {{ dashboardData.mascotasTotales }} totales</div>
        </div>
      </div>
      
      <div class="metric-card">
        <div class="metric-icon">
          <i class="fa fa-dollar"></i>
        </div>
        <div class="metric-info">
          <h3>Ventas Totales</h3>
          <div class="metric-value">{{ dashboardData.ventasTotales | currency:'USD':'symbol':'1.2-2' }}</div>
        </div>
      </div>
      
      <div class="metric-card">
        <div class="metric-icon">
          <i class="fa fa-line-chart"></i>
        </div>
        <div class="metric-info">
          <h3>Ganancias</h3>
          <div class="metric-value">{{ dashboardData.gananciasTotales | currency:'USD':'symbol':'1.2-2' }}</div>
        </div>
      </div>
    </div>

    <!-- Gráficos -->
    <div class="charts-row">
      <!-- Gráfico de barras: Tratamientos por medicamento -->
      <div class="chart-container">
        <h3>Tratamientos por Medicamento (Último Mes)</h3>
        <canvas #medicamentoChart></canvas>
      </div>
      
      <!-- Gráfico de pie: Top tratamientos -->
      <div class="chart-container">
        <h3>Top 3 Tratamientos</h3>
        <canvas #topTratamientosChart></canvas>
      </div>
    </div>

    <div class="charts-row">
      <!-- Gráfico doughnut: Estado de mascotas -->
      <div class="chart-container">
        <h3>Estado de Mascotas</h3>
        <canvas #mascotasChart></canvas>
      </div>
      
      <!-- Gráfico doughnut: Estado de veterinarios -->
      <div class="chart-container">
        <h3>Estado de Veterinarios</h3>
        <canvas #veterinariosChart></canvas>
      </div>
    </div>

    <!-- Tabla de detalle: Tratamientos por medicamento -->
    <div class="detail-section">
      <h3>Detalle de Tratamientos por Medicamento (Último Mes)</h3>
      <table class="detail-table">
        <thead>
          <tr>
            <th>Medicamento</th>
            <th>Cantidad</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="dashboardData.tratamientosPorMedicamento.length === 0">
            <td colspan="2" class="text-center">No hay datos disponibles</td>
          </tr>
          <tr *ngFor="let tratamiento of dashboardData.tratamientosPorMedicamento">
            <td>{{ tratamiento.nombreMedicamento }}</td>
            <td>{{ tratamiento.cantidad }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Tabla de detalle: Top tratamientos -->
    <div class="detail-section">
      <h3>Top 3 Tratamientos (Por Unidades Vendidas)</h3>
      <table class="detail-table">
        <thead>
          <tr>
            <th>Posición</th>
            <th>Medicamento</th>
            <th>Unidades Vendidas</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="dashboardData.topTratamientos.length === 0">
            <td colspan="3" class="text-center">No hay datos disponibles</td>
          </tr>
          <tr *ngFor="let tratamiento of dashboardData.topTratamientos; let i = index">
            <td>{{ i + 1 }}</td>
            <td>{{ tratamiento.nombreMedicamento }}</td>
            <td>{{ tratamiento.unidadesVendidas }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div> 